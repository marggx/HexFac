var at=Object.defineProperty;var ht=(r,t,e)=>t in r?at(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>ht(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();function lt(r,t){const e=JSON.stringify(t);localStorage.setItem(r,btoa(encodeURIComponent(e)))}function ct(r){if(!localStorage.getItem(r))return;const t=decodeURIComponent(atob(localStorage.getItem(r)));return JSON.parse(t)}const gt={layout:{maxSize:70,minSize:15}},ut={forest:["./../assets/img/forest.png"],rock:["rock.png"],furnace:["rock.png"]};let I=gt;function dt(){let r=ct("settings");return r&&(I=r),I}function Q(r){if(r.includes(".")){const t=r.split(".");let e=I;for(let i=0;i<t.length;i++){const s=t[i];if(e[s]===void 0)return;e=e[s]}return e}return I[r]}function pt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var O={exports:{}},ft=O.exports,j;function xt(){return j||(j=1,function(r,t){(function(e,i){r.exports=i()})(ft,function(){return e.importState=function(s){var n=new e;return n.importState(s),n},e;function e(){return function(s){var n=0,a=0,h=0,l=1;s.length==0&&(s=[+new Date]);var g=i();n=g(" "),a=g(" "),h=g(" ");for(var p=0;p<s.length;p++)n-=g(s[p]),n<0&&(n+=1),a-=g(s[p]),a<0&&(a+=1),h-=g(s[p]),h<0&&(h+=1);g=null;var d=function(){var f=2091639*n+l*23283064365386963e-26;return n=a,a=h,h=f-(l=f|0)};return d.next=d,d.uint32=function(){return d()*4294967296},d.fract53=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.version="Alea 0.9",d.args=s,d.exportState=function(){return[n,a,h,l]},d.importState=function(f){n=+f[0]||0,a=+f[1]||0,h=+f[2]||0,l=+f[3]||0},d}(Array.prototype.slice.call(arguments))}function i(){var s=4022871197,n=function(a){a=a.toString();for(var h=0;h<a.length;h++){s+=a.charCodeAt(h);var l=.02519603282416938*s;s=l>>>0,l-=s,l*=s,s=l>>>0,l-=s,s+=l*4294967296}return(s>>>0)*23283064365386963e-26};return n.version="Mash 0.9",n}})}(O)),O.exports}var yt=xt();const mt=pt(yt),nt=Math.sqrt(3),St=.5*(nt-1),C=(3-nt)/6,_=r=>Math.floor(r)|0,$=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function At(r=Math.random){const t=vt(r),e=new Float64Array(t).map(s=>$[s%12*2]),i=new Float64Array(t).map(s=>$[s%12*2+1]);return function(n,a){let h=0,l=0,g=0;const p=(n+a)*St,d=_(n+p),f=_(a+p),S=(d+f)*C,H=d-S,T=f-S,y=n-H,m=a-T;let V,B;y>m?(V=1,B=0):(V=0,B=1);const K=y-V+C,U=m-B+C,W=y-1+2*C,R=m-1+2*C,z=d&255,Y=f&255;let A=.5-y*y-m*m;if(A>=0){const x=z+t[Y],w=e[x],b=i[x];A*=A,h=A*A*(w*y+b*m)}let v=.5-K*K-U*U;if(v>=0){const x=z+V+t[Y+B],w=e[x],b=i[x];v*=v,l=v*v*(w*K+b*U)}let M=.5-W*W-R*R;if(M>=0){const x=z+1+t[Y+1],w=e[x],b=i[x];M*=M,g=M*M*(w*W+b*R)}return 70*(h+l+g)}}function vt(r){const e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){const s=i+~~(r()*(256-i)),n=e[i];e[i]=e[s],e[s]=n}for(let i=256;i<512;i++)e[i]=e[i-256];return e}const Mt="/HexFac/assets/grass_12-BMZo7A7F.png",wt="/HexFac/assets/grass_13-YbShMGaZ.png",bt="/HexFac/assets/grass_14-BX8rd9hq.png",Ct="/HexFac/assets/grass_15-CF7sRd7j.png",It="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAACMCAYAAAC3Z23dAAAPTUlEQVR42u1diXYUxxWdP/DBGAjGNhAkJCT2fRUS+xIbO7EBA9qRQOyL7QSwg4lZDTE2wSfBsQM2O4iMJMyOTThJjp345PgT/An+hE7dmnmjnp7unuqe6unq7upz7tEyMz1S36lX7753qzqVSsgx4Nwbz1TcbDoN4PuUPuJzVHY37ay81fxz1d9bDADf43f6ykT8GHGjcX5ld/OPRKwVeAzP0VcqYsfQS+uGV3Q3p52ItQLPxWv0lYvCPHur6aA5HIsCr8Fr9fys6FF1s2nV6JvNP3kl1gp+DnYufUUVOUZe2zChqrv5SanEFoCdE+fWVzhk2SOdWOv8rGVV+LInaGhZpYjsCZxoLavUkD2Bh20tq8KXPeUI21pWKSB7goaWVarInqChZZUaskfLqgTIHi2rEiJ7tKxKiOzRsioBskfLqoTIHi2rkiJ7tKxKhuzRsioBskfLKsVlz/hvtxhVaS2rYil7qvvaOMFjvm7XsiqOsmdMX7sx7tFmo+ZuR+Z36VYtq+Ike8bcbjdq73caNfc62CjeyL/XsioGsqe6t5WN3jYemmvubMwBvwvrb8L7V/e0qimrIid70i0Zgi0IM9kai6mCkaycrNKyR8YHrtUY97irPxdQQVbFvdtTniy+3RiDqYGh9sEmKQSXLKuS1u1xDKnXGo3Vh5cJY9HZ1wrPw+ZckGoGpFv17fbyy6okd3usmPm3NcbBlinGkfUTPaF1/wJbqWZFdW9beWVVVLs9si8Ujdy9W2Zxwj7tnG5c2D5bCKdbMx+IFR+9oo6sinK3B+FuwtNt0s+7fedcThQIe/T+ImH07Kvnr8PIRwRQolsVJdmTJ3HY3Dbum65MnVni+2AuBUknmycb995b4IlgACMZr0cEQCQI+7pFhmAUCCAzau918iQFFSn8DMgM0zTv9vxuvmdyCRSq7eZjTbALallIHsukhhU8aekpvcZcd+51TsyplslG7775xsODC30RjFB9vHFS6PNx5AhG+bH2XocjSiX51RMrOSlnO6YZaTaCexjJ93/vj+SLO+coMR9HguCXPn7FeOHoco6KS+t408AKGboSIRWknN8+ixNM8EvymY3T+PmQtGmCHTCIJS0DWMJjxvAzr2aKBSbIqDGTNLq6Z24ewX5Jvr2/IaePNcE2GPruQk7os5tnGIPZRR701rwcyb88v1b6+xEZVnL7SfaWVfftrzc+bMrMxWGFaWUJHvnZ6xly2Xz4/B9XGsM+eZlj8IEG/vvBe+ZJfT9KsE63TXEkGLgrKJ1uH6jnz8f5cF7bMmaSCR7y23pO5BA2aohcAkjHY/gQyHo/SrA+65rhSrBIuMaHgJ6L8+G80NeaYCqes0SKQrF59BJAOh5DCPfk7mDJGGSV3WOb3prPifhyx2wBghcUDc30XCRsOC/OrzzBY263ly1rBoHPsYttJZfAw3f7VM86esKTrbb/x76O6ZyI62yeL5XgO+825J57adecXGVLeYJR9w2iuO+UXCGxciJ44NaZ/DkY7cK1a6aVUd4c+3gzb8BDN+N3E1kWDhKQEBUj1yvBQJiZtDDBZD8dxy+OyRYDO6pkG8xAljWDvF8cXuJIMGXUGO3iBHcaYx9uLkA9y3BBwJmNU4UIflCkwnXPNAcDYWbSngge96iLA/VgdHJwcfCzTCtq5fXG3PzrRC6fhw8tyszRh5YITS3cdIeK1/3OAqw+ulw4wUoL1Kgxws3PDzOTFiKYh7JsgmJFqSYyJ3mEEOxG8NBjS4XlEqYVs7Myz2XJIhAlWJgv5RC8MO/5YWbSKaGLY7Gc5NlPeuUayVGO5AnW7rmuBFOiBYhGIIxkK+q/WM0vPpoDIuSmBbtM5ueHmUmLjWBcDJv6L1DVI5dghNxiCZZVDyOsi/STEYnMmHJ5Xa49eIPN6Rh5aDDIJjjMTFpsDkbGyUayE2TOwQi5xRIsaybtp+BhtuV8zs5DxKBF2LuvdILNWjjMTFq5QsfgvXVlIZjmXXR8rOQUI9kPwWFl0koRjDnxuS0Z0pBEFSMY87RXqWSuO2PedbPlUD3ZD8FfH2hQIpNWawSzeVJEIuUaD+zC4blIzPz0fb/aOVu4aUDAHC1CsLXYQZn0+oOLkx2igyYYcy8u9LENE43ud+o4EcXIMjcPEHr9EIweM94XJVFNcIAEwyNltuWINvOJZFGCrcUO8zxczjCdOILtiho9ggY7kFYKwcjWy+22LBvBKGuGTfDki+scmwqYa0WI8+K0tL4HOlV4/11Me5PHzGuCqCTByI7HP9kq1IlCC5Bn0R8ul04wNfX/vGm6bXbsx+gu2nAgtLZOKfCYwXcmVKxRleCaOx0Zg7rA6no3J0dBJSvbdRLVwVTYcOv5PvDphXarRRM+2Tu3n1T2N+ADSv8D/u/IEYyuE0zp+MoN6gKGAWo2DGC60W0UkzcLrUXR1YJkanerUonOsW4h3KncOTNbWsXfTv8HHCtBWJDKQjBq1ebGBDo3vDlRpH5N5UqQbK1o4YKY3ZUjPhXLSKE/qSxZrNYsIp2c4FQBO7Z7Ts5E6GRBkm0kDD5EMyLtOjhutevRN5qMUZ+vNgbtmJMjcc/+BuNPjGjg17v7w9wLR5YZFV++KfS3kCUH2lfEsfG/Uyts8cPJ5cb3J5bZ4vGhRY7nXNA53bWJ0m8HXhNvmTSKhVIQDFDZ8sjbdbkRsn77rEytel9D7nmVVzcIlSZFHRvf/mGRI8Fu+OeRJY7nfL5lsmvySGXXF0+ujDnBWdIAkIh/eiILayAZGJbNQl869XI/wZfXC5UmRRyTwNPDi30R/O9jS92TKzblFMspZCdbSo/gEWdfM55tm1ogK4a8PT/vg1BsBHtxTAIgyg/BP7DRaXe+rmzUcXOJkkPFq1M0cgRXXtuQRx5IRvKBORlfXzy+Iu/xUQJzFi3qLpZBE0CUH4IBu/P9avN0IRMDfYC9OEUjaXznJJ9fk0+kFV+sNiq+etMY3d3sqbkvYqzzSy5gbROa5VGxHncp/e1ILj4bfb2Rk1hxYW0eMOeKEGung51WD/avPWooiWC83npOt1UadlZgr+3P2CwAl7X/BmrRTnLJTSKJ4PH7+VWsy+/UCdfXqfQqYgXWBBfZQcfcLpQhkQh4vV2Bo5gNGEAIl13wSBzB6CiRk9JONkHLlkKwVSppgkMANf3h6rBKJ78SyYngvTtmC/u8UQTxUl/XBAs0/q0Lvksh104qtWQzYxGft1czvya4iHSiUE0NCHSBZBO8tnOaJjgsUI2apFOpEskqlWAsWNk4SRMcJqiNiCoXXBiyCKb1SIkhGKMFbkKhPZbLHKqpynWua4Zxfe88V/TtqzcewfXhgltM+1JkmLVtdvwIBmno4EBzUqHf6x7LUdgbuhjwAabVkpEnmEh1ulDYvRXrgFALNiPsjcLM+hjyqdiu7vTBNWPH7nnGDqZdt+9i3++p46C1wLntoJj0KUYuLWpXTgdTdYgAfYlK0TUW0rAxZ/5GnfmFBcx9eA1CeGTvy9Dbltn14E4H/wrYbUnhNoqhgcmbJdNKm5JVNEB9F1kjGcp7HdbwWFfdwWWhwq6sMvxneXtn9mXWVOMx+MYo9KKiZXV1cE9W25SchVapfjAV8K1tOCf7qdOirLA2CpPpP3NaN43WJ/xjZF6YxEY0eczgNyPyYVEa+Zff8Hap0gS7rfW5azGEox4c9o6sgfa2r/YbGGBWIAsSXQ/YkIjcXK9b4hrilKySH23B67SX42OGp+wT+93xZXlhmpZzIDlTbSkr7lRWMsGX1+eIw+ikUQzzYOfOOZxs3iJ8b1GeoUEZginBwtzrtlEnyKVCwHfHl9pub6DCPQ7659R2KfeDMI9gAKHa6jEb2Dmdk6/kCCaCUQRwM4T/62h+lwbORevqdyUy6ey8CaM+bksrY2c/q/1o+Mer+IgFhh1aUmBHUmoOpioQbkThtngLxnBrSQ/LPKhmq0qihY3R+IqM7KZpMvbnhL0I1iP4yFx9ZuyDIJNcKQSbq0BuJP/XxqkI9yJMamGsm3UMzX1tBRul8V3lJewHBqIrr6wv8JhVXFzH/WfKLj4TIdmpMP8fNrKv7JmjTiadbim4XUB1yLelVaJUaSYZZUlzBevJB+4rBZ5+sFiZkmXcILXZAJKpuYAtiohkcwZN+B5yiT1+gcmFE9m9K5STSppg9/YbkUwZNJH61y0zC5oRIDfs1qEm2CfJV/bMzdWczcBoR8M9yo0G1QsvgTX8zSSbgd9hr4zQ784ZuWaGv8JLoI4OkAwyoW/RLULPVZPlc58TbMCOEexxd19fBGO/jWrJ2whrON9noubuxtzu9F71uC+Cx3/Txct4moBwCi+oromWUH0SvIWjJtvQRv2Wb7JSptvuJC25si28BDaCWWjGXADUPtzEwwb9XI5b7mgElWSls3cvMc0HZmAEq+iVimqJMRQdDFOZE1QcvXwDtoTnCilvI8J+3ys+6fe1KUfyWDaFQDuab/1D/0NiCK7sbtpZeav5Z2GSLXcuMUO1cFjL5Bz2yARAMv1stbXG0gvGOAW3KRwDzr3xTMXNptOxyjyRDNrcyItr+Jgng+ASnKasx8hrGyZUdTc/iXxxAKOVJX12kH2nNqXAuAOHqWJH1c2mVaNvNv8U5ZUGTjfygiFd5n2elNiNCFwxzlJeDh62bzUd9DI/q25EzxnSY1JmBTfgyDYcix5DL60bXtHdnNZFA8XmWcYJuEnJOkbcaJxf2d38o764IY9axgG4SAV1eJVVGgHInqCPsGQVlUUTF46dZE/QR7llFQoVondvSZTsCfool6zC6OWVKEY0l0N9mYXXcRvVvmRPWcJ2wLIKN9eyA9e2Ah8O1Ue+FNkT9BGErKrJ3r2FtkewQuQc4x5v9tzS5JEhHVHZE/QhU1bxPrTJtmKGkLsh3cotRl4JnvCPbbx2HWnZE/QhRVbBbIA9L1zg+MHg92vKmBQ81aHZe6LVCMAHRdUxmOBkVMLKKnsiIavSmQtsi7TzyC0Y8bxO3S5Uz8aoB8ZmrUn0c6m17NBkT9xkFWXaBYa1ItZTbmLgo35TAWjnnEjLnrjIKr+Rwnw7Piv8hGclZU8cZJX/dqOLNcm0PVIsZE8UZZWsnrJju1GA4MjJnijJqlh3e6J+RLVbFSvZE9dulZY9CZBVWvZoWZVM2ZMEWaVlT4xllZY9MZVVWvbEVFZp2RNjWaVlT1xllZY98ZRVWvbEVFZp2RNjWaVlT0xlVdJkz/8ByyN5V6Dv2ygAAAAtdEVYdFNvZnR3YXJlAGJ5LmJsb29kZHkuY3J5cHRvLmltYWdlLlBORzI0RW5jb2RlcqgGf+4AAAAASUVORK5CYII=",Jt="/HexFac/assets/dirt_13--YxG2BSR.png",Vt="/HexFac/assets/dirt_14-BFJ4a5Jb.png",Bt="data:image/png;base64,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",Ot="/HexFac/assets/dirt_16-bRrLznJ8.png",qt="/HexFac/assets/dirt_17-D9GoZj0H.png",Pt={"grass_12.png":Mt,"grass_13.png":wt,"grass_14.png":bt,"grass_15.png":Ct,"grass_16.png":It,"dirt_13.png":Jt,"dirt_14.png":Vt,"dirt_15.png":Bt,"dirt_16.png":Ot,"dirt_17.png":qt},tt=Math.sqrt(3),J=document.getElementById("game"),c=J.getContext("2d");c.imageSmoothingEnabled=!0;c.imageSmoothingQuality="high";k(J,c);addEventListener("resize",()=>k(J,c));function k(r,t){const e=innerWidth,i=innerHeight;r.width=e*window.devicePixelRatio,r.height=i*window.devicePixelRatio,r.style.width=e+"px",r.style.height=i+"px",t.scale(window.devicePixelRatio,window.devicePixelRatio)}function Ht(){c.clearRect(0,0,J.width,J.height)}const rt={};for(const[r,t]of Object.entries(Pt)){const e=new Image;e.src=t,rt[r]=e}function X(r,t,e,i){c.beginPath(),c.moveTo(r[0].x,r[0].y);for(let s=1;s<r.length;s++)c.lineTo(r[s].x,r[s].y);c.closePath(),t!==null&&(c.fillStyle=t,c.fill()),c.lineWidth=i,e!==null&&(c.strokeStyle=e),c.stroke()}function Tt(r,t,e,i){const s=rt[i];s&&c.drawImage(s,r.x-tt*t/2,r.y-2*e/2,tt*t,2*e)}function Kt(r,t,e){c.beginPath();for(let i=0;i<r.length;i++)c.moveTo(r[i][0].x,r[i][0].y),c.lineTo(r[i][1].x,r[i][1].y);c.fillStyle="blue",c.fill(),c.lineWidth=e,c.strokeStyle=t,c.stroke()}function Ut(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}function Z(r,t){const e=Math.pow(10,t);return Math.floor(r*e)/e}function Wt(r){return r>0}class q{constructor(t,e,i,s=!0){o(this,"q");o(this,"r");o(this,"s");o(this,"id");o(this,"exists");if(Math.round(t+e+i)!==0)throw"q + r + s must be 0";this.q=t,this.r=e,this.s=i,this.id=t+"_"+e+"_"+i,this.exists=s}getPosition(){return{q:this.q,r:this.r,s:this.s}}}class F extends q{constructor(e,i,s,n,a,h,l,g){super(e.q,e.r,e.s);o(this,"type");o(this,"level");o(this,"image");o(this,"range");o(this,"conenctToSameType");o(this,"updateable",!1);o(this,"recipe");o(this,"placableOn");o(this,"publicStorage",new Map);o(this,"publicStorageChange",new Map);o(this,"publicStoragePS",new Map);o(this,"privateStorage",new Map);o(this,"isHighlighted",!1);this.type=i,typeof s=="string"?this.image=[s]:this.image=s??ut[i],this.level=n??1,this.range=a??0,this.conenctToSameType=h??!0,this.recipe=l,this.placableOn=g,l&&this.setRecipe(l)}setRecipe(e){this.recipe=e,this.updateable=!0,this.recipe.outputs.forEach(i=>{let s=i.clone();s.value=0,this.publicStorage.set(s.type,s)}),this.recipe.inputs.forEach(i=>{let s=i.clone();s.value=0,this.privateStorage.set(s.type,s)})}update(e,i){this.getRecipeInputFromNearbyBuildings(i),this.setStorageBasedOnRecipe(e)}setStorageBasedOnRecipe(e){var a;let i=!0;const s=this.recipe.inputs,n=this.recipe.outputs;for(let h=0;h<s.length;h++)if(((a=this.privateStorage.get(s[h].type))==null?void 0:a.value)>=s[h].value)i=!0;else{i=!1;break}if(!i){this.addDeltaToChange(0,e,null);return}for(let h=0;h<n.length;h++){let l=n[h],g=this.publicStorage.get(l.type);if(!g)return;let p=e*l.value;g.value+=p,this.addDeltaToChange(p,e,l.type)}for(let h=0;h<s.length;h++){let l=s[h],g=this.privateStorage.get(l.type);if(!g)return;g.value-=e*l.value}}addDeltaToChange(e,i,s){if(this.isHighlighted)if(s){let n=this.publicStorageChange.get(s);n?(n[0]+=e,n[1]+=i,n[1]>=1&&(this.publicStoragePS.set(s,Z(n[0],2)),n[0]=0,n[1]=0)):this.publicStorageChange.set(s,[e,i])}else for(let n=0;n<this.recipe.outputs.length;n++){let a=this.recipe.inputs[n],h=this.publicStorageChange.get(a.type);h?(h[0]+=e,h[1]+=i,h[1]>=1&&(this.publicStoragePS.set(a.type,Z(h[0],2)),h[0]=0,h[1]=0)):this.publicStorageChange.set(a.type,[e,i])}}getRecipeInputFromNearbyBuildings(e){for(let i=0;i<this.recipe.inputs.length;i++){let s=this.recipe.inputs[i],n=this.privateStorage.get(s.type).value;if(!(n>=this.recipe.inputs[i].value))for(let a=0;a<e.length;a++){if(!(e[a]instanceof F))continue;let h=e[a].publicStorage.get(s.type);if(!h)continue;let l=Math.min(s.value,h.value);if(n+=l,h.value-=l,this.addDeltaToChange(-l,0,s.type),n>=s.value)break}}}toJSON(){return{q:this.q,r:this.r,s:this.s,type:this.type,level:this.level}}}class G{constructor(t,e,i,s,n){o(this,"type");o(this,"name");o(this,"value");o(this,"description");o(this,"icon");this.type=t,this.name=e,this.description=s,this.icon=n,this.value=i}clone(){return new G(this.type,this.name,this.value,this.description,this.icon)}}class Rt extends G{constructor(){super("wood","Wood",1,"A piece of wood",'<img src="data:image/png;base64,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">')}}class zt{constructor(t,e,i,s,n){o(this,"id");o(this,"name");o(this,"icon");o(this,"inputs");o(this,"outputs");this.id=t,this.name=e,this.icon=i,this.inputs=s??[],this.outputs=n??[]}}class Yt extends zt{constructor(){super("wood","Wood","wood",[],[new Rt])}}class u{constructor(t,e,i,s){o(this,"x");o(this,"y");o(this,"maxY");o(this,"minY");o(this,"maxX");o(this,"minX");this.x=t,this.y=e,this.maxX=i,this.maxY=i,this.minX=s,this.minY=s}add(t){return this.x=this.maxX?Math.min(this.x+t.x,this.maxX):this.x+t.x,this.y=this.maxY?Math.min(this.y+t.y,this.maxY):this.y+t.y,this.x=this.minX?Math.max(this.x,this.minX):this.x,this.y=this.minY?Math.max(this.y,this.minY):this.y,this}subtract(t){return this.x=this.minX?Math.max(this.x-t.x,this.minX):this.x-t.x,this.y=this.minY?Math.max(this.y-t.y,this.minY):this.y-t.y,this.x=this.maxX?Math.min(this.x,this.maxX):this.x,this.y=this.maxY?Math.min(this.y,this.maxY):this.y,this}multiply(t){return this.x*=t,this.y*=t,this}equal(t){return Math.round(this.x)===Math.round(t.x)&&Math.round(this.y)===Math.round(t.y)}greaterThan(t){return this.x>t.x&&this.y>t.y}lessThan(t){return this.x<t.x&&this.y<t.y}difference(t){return new u(Math.abs(this.x-t.x),Math.abs(this.y-t.y))}toString(){return`(${this.x}, ${this.y})`}clone(){return new u(this.x,this.y,this.maxX,this.minX)}toJSON(){let t={x:this.x,y:this.y};return this.maxX&&(t.max=this.maxX),this.minX&&(t.min=this.minX),t}}let Nt=["grass_12.png","grass_13.png","grass_14.png","grass_15.png","grass_16.png","dirt_13.png","dirt_14.png","dirt_15.png","dirt_16.png","dirt_17.png"];class Xt{constructor(t,e="HexFactory"){o(this,"hexagons",new Map);o(this,"seed");o(this,"directions",[{q:1,r:0,s:-1},{q:1,r:-1,s:0},{q:0,r:-1,s:1},{q:-1,r:0,s:1},{q:-1,r:1,s:0},{q:0,r:1,s:-1}]);o(this,"PI2",Math.PI*2);o(this,"anglesCosSin",[new u(Math.cos(this.PI2*.5/6),Math.sin(this.PI2*.5/6)),new u(Math.cos(this.PI2*-.5/6),Math.sin(this.PI2*-.5/6)),new u(Math.cos(this.PI2*-1.5/6),Math.sin(this.PI2*-1.5/6)),new u(Math.cos(this.PI2*-2.5/6),Math.sin(this.PI2*-2.5/6)),new u(Math.cos(this.PI2*-3.5/6),Math.sin(this.PI2*-3.5/6)),new u(Math.cos(this.PI2*-4.5/6),Math.sin(this.PI2*-4.5/6))]);o(this,"hexPositionCache",new Map);o(this,"hexRingCache",new Map);this.seed=e;let i=mt(this.seed),s=At(i);for(let n=-t;n<=t;n++){const a=Math.max(-t,-n-t),h=Math.min(t,-n+t);for(let l=a;l<=h;l++){let g=Nt[Math.floor(Math.abs(s(-n,l))*10)];this.hexagons.set(n+"_"+l+"_"+(-n-l),new F({q:n,r:l,s:-n-l},g,void 0,1,1,!0,new Yt))}}}getCachedHexPosition(t,e){let i=this.hexPositionCache.get(t.id);if(i!==void 0)return i;let s=this.polygonCorners(e,t),n=this.hexToPixel(e,t);return this.hexPositionCache.set(t.id,[s,n]),[s,n]}update(t){this.hexagons.forEach(e=>{e.updateable&&e.update(t,this.range(e,e.range))})}draw(t){t.changed&&this.hexPositionCache.clear();let e=0;this.hexagons.forEach(i=>{let[s,n]=this.getCachedHexPosition(i,t);this.isHexInViewport(t,i,s)&&(e++,Tt(n,t.size.x,t.size.y,i.type),X(s,null,"darkgray",1))}),console.log("drawn hexagons: "+e)}getHexagon(t){return this.hexagons.get(t)}getHexagonByCords(t){return this.hexagons.get(t.q+"_"+t.r+"_"+t.s)}replaceBuilding(t){this.hexagons.set(t.id,t)}axialToCube(t){const e=t.x,i=t.y,s=-e-i;return{q:e,r:i,s}}cubeToAxial(t){const e=t.q,i=t.r;return new u(e,i)}add(t,e,i=!1){let s=this.getHexagonByCords({q:t.q+e.q,r:t.r+e.r,s:t.s+e.s});return!s&&i&&(s=new q(t.q+e.q,t.r+e.r,t.s+e.s,!1)),s}subtract(t,e,i=!1){let s=this.getHexagonByCords({q:t.q-e.q,r:t.r-e.r,s:t.s-e.s});return!s&&i&&(s=new q(t.q-e.q,t.r-e.r,t.s-e.s,!1)),s}multiply(t,e,i=!1){let s=this.getHexagonByCords({q:t.q*e,r:t.r*e,s:t.s*e});return!s&&i&&(s=new q(t.q*e,t.r*e,t.s*e,!1)),s}equals(t,e){return t.q===e.q&&t.r===e.r&&t.s===e.s}length(t){return(Math.abs(t.q)+Math.abs(t.r)+Math.abs(t.s))/2}distance(t,e){let i=this.subtract(t,e);return i?this.length(i):1}getNeighbor(t,e,i=!1){return typeof e=="number"&&(e=this.directions[e]),this.add(t,e,i)}getNeighbors(t){let e=[];for(let i=0,s=this.directions.length;i<s;i++){let n=this.getNeighbor(t,i);e.push(n)}return e}isNeighbor(t,e){return this.distance(t,e)===1}ring(t,e){let i=this.hexRingCache.get(t.id+"_"+e);if(i!==void 0)return i;let s=[],n=this.add(t,this.multiply(this.directions[4],e,!0),!0);for(let a=0;a<6;a++)for(let h=0;h<e;h++)n.exists?(s.push(n),n=this.getNeighbor(n,a,!0)):n=this.getNeighbor(n,a,!0);return this.hexRingCache.set(t.id+"_"+e,s),s}range(t,e){let i=[];for(let s=0;s<=e;s++)i=i.concat(this.ring(t,s));return i}hexToPixel(t,e){const i=t.orientation,s=t.size,n=t.origin,a=(i.f0*e.q+i.f1*e.r)*s.x,h=(i.f2*e.q+i.f3*e.r)*s.y;return new u(a+n.x,h+n.y)}pixelToHex(t,e){const i=t.orientation,s=t.size,n=t.origin,a=new u((e.x-n.x)/s.x,(e.y-n.y)/s.y),h=i.b0*a.x+i.b1*a.y,l=i.b2*a.x+i.b3*a.y;return this.roundHex({q:h,r:l,s:-h-l})}roundHex(t){let e=Math.round(t.q),i=Math.round(t.r),s=Math.round(t.s);const n=Math.abs(e-t.q),a=Math.abs(i-t.r),h=Math.abs(s-t.s);return n>a&&n>h?e=-i-s:a>h?i=-e-s:s=-e-i,this.getHexagonByCords({q:e,r:i,s})}hexCornerOffset(t,e){const i=t.size;return new u(i.x*this.anglesCosSin[e].x,i.y*this.anglesCosSin[e].y)}polygonCorners(t,e){const i=[],s=this.hexToPixel(t,e);for(let n=0;n<6;n++){const a=this.hexCornerOffset(t,n);i.push(a.add(s))}return i}isHexInViewport(t,e,i=null){i=i??this.polygonCorners(t,e);for(let s=0,n=i.length;s<n;s++)if(t.isVectorInViewport(i[s]))return!0;return!1}outlineHexGroup(t,e){let i=[];for(let s=0,n=e.length;s<n;s++){let a=e[s],h=this.getNeighbors(a);for(let l=0,g=h.length;l<g;l++){let p=h[l];if(!p||e.indexOf(p)===-1){let d=this.hexToPixel(t,a),f=this.hexCornerOffset(t,l),S=this.hexCornerOffset(t,(l+1)%6),H=new u(d.x+f.x,d.y+f.y),T=new u(d.x+S.x,d.y+S.y);i.push([H,T])}}}return i}toJSON(){return{hexagons:this.hexagons,seed:this.seed}}}function Zt(r){const{game:t}=r;t.canvas.addEventListener("pointerup",e=>t.tapUp({x:e.clientX,y:e.clientY})),t.canvas.addEventListener("pointerdown",e=>t.tapDown({x:e.clientX,y:e.clientY})),t.canvas.addEventListener("pointermove",e=>{t.tapMove({x:e.movementX,y:e.movementY})}),t.canvas.addEventListener("wheel",e=>t.zoom(new u(e.deltaY*-1/50,e.deltaY*-1/50))),document.addEventListener("keydown",e=>{e.ctrlKey&&t.layout.reset()})}const N=Math.sqrt(3),Dt={f0:N,f1:N/2,f2:0,f3:3/2,b0:N/3,b1:-1/3,b2:0,b3:2/3,startAngle:.5};class Et{constructor(t,e,i,s){o(this,"orientation");o(this,"size");o(this,"origin");o(this,"viewport");o(this,"changed",!0);o(this,"center");this.orientation=t,this.size=new u(e.x,e.y,i,s);let n=window.innerWidth,a=window.innerHeight;this.origin=new u(n/2,a/2),this.viewport=new u(n,a),this.center=new u(n/2,a/2)}setOrientation(t){this.changed=!0,this.orientation=t}isVectorInViewport(t){return t.greaterThan({x:-10,y:-10})&&t.lessThan({x:this.viewport.x+10,y:this.viewport.y+10})}setOrigin(t,e=!1){this.changed=!0,e?this.origin.add(t):this.origin=t}reset(){this.changed=!0,this.origin=this.center.clone(),this.viewport=new u(window.innerWidth,window.innerHeight)}setSize(t,e=!1){this.changed=!0,e?this.size.add(t):this.size=t}toJSON(){return{origin:this.origin,size:this.size}}}class Lt{constructor(t){o(this,"initSteps");o(this,"step",0);o(this,"loadingScreen");o(this,"loadingText");o(this,"loadingProgress");this.initSteps=t,this.loadingScreen=document.querySelector("#loadingScreen"),this.loadingText=document.querySelector("#loadingText"),this.loadingProgress=document.querySelector("#loadingProgress")}stepLoadingScreen(t,e){if(this.step===0&&(this.loadingProgress.max=this.initSteps),this.step+=t,this.step>=this.initSteps){this.loadingScreen.style.display="none";return}this.loadingProgress.value=this.step,this.loadingText.innerHTML=e}}const kt="↗︎",Ft="↘︎";let D=!1,P,E,L;function Gt(){D||(P=document.getElementById("stats"),D=!0)}function Qt(r,t){if(!D)throw Error("UI not initialized");E=r,L=t;let e="";r.forEach(i=>{e+=`<div class="stat" id="${i.type}">
            <div class="stat-figure text-secondary">
                ${i.icon}
            </div>
            <div class="stat-title">${i.name}</div>
            <div class="stat-value">${Ut(i.value,2)}</div>
            <div class="stat-desc">${ot(i.type)}</div>
        </div>`}),P.innerHTML=e}function jt(){E&&E.forEach(r=>{let t=P.querySelector("#"+r.type+" .stat-value"),e=P.querySelector("#"+r.type+" .stat-desc");!t||!e||(t.innerHTML=Z(r.value,2).toString(),e.innerHTML=ot(r.type))})}function ot(r){if(!L)return"";let t=L.get(r),e="";return t===void 0?e="...":e=(Wt(t)?kt:Ft)+" "+t.toString(),e}const _t=59,et=1e3/_t,$t=10,it=1e3/$t,te=4,st=1e3/te;class ee{constructor(){o(this,"canvas",document.querySelector("#game"));o(this,"ctx",this.canvas.getContext("2d"));o(this,"layout");o(this,"hexMap",new Xt(15));o(this,"FPSOldTimeStamp",0);o(this,"UPSOldTimeStamp",0);o(this,"UIPSOldTimeStamp",0);o(this,"tapedHex");o(this,"highlightedHex");o(this,"tap",0);let t=new Lt(15);dt(),t.stepLoadingScreen(5,"Loading settings"),this.layout=new Et(Dt,new u(20,20),Q("layout.maxSize"),Q("layout.minSize")),t.stepLoadingScreen(1,"Layout"),Gt(),t.stepLoadingScreen(1,"noise"),Zt({game:this}),t.stepLoadingScreen(15,"start"),this.init()}init(){k(document.querySelector("#game"),document.querySelector("#game").getContext("2d")),this.gameLoop(0)}draw(){if(this.hexMap.draw(this.layout),this.highlightedHex){let t=this.hexMap.range(this.highlightedHex,1);Kt(this.hexMap.outlineHexGroup(this.layout,t),"darkgreen",2);for(let e of t)X(this.hexMap.polygonCorners(this.layout,e),"rgba(0, 200, 0, 0.5)","rgba(0, 0, 200, 0)",1);X(this.hexMap.polygonCorners(this.layout,this.highlightedHex),"rgba(0, 0, 200, 0.5)","rgba(0, 0, 200, 0)",1)}}gameLoop(t){let e=t-this.FPSOldTimeStamp,i=t-this.UPSOldTimeStamp,s=t-this.UIPSOldTimeStamp;e>et&&(Ht(),this.draw(),this.FPSOldTimeStamp=t-e%et,this.layout.changed=!1),i>it&&(this.UPSOldTimeStamp=t-i%it,this.update(i/1e3)),s>st&&(this.UIPSOldTimeStamp=t-s%st,jt()),window.requestAnimationFrame(n=>this.gameLoop(n))}update(t){this.hexMap.update(t)}async save(){let t={layout:this.layout,hexMap:this.hexMap};lt("save",t)}async load(){}zoom(t){let e=this.hexMap.pixelToHex(this.layout,this.layout.center);if(this.layout.setSize(t,!0),e){let i=this.hexMap.hexToPixel(this.layout,e);this.layout.setOrigin({x:this.layout.center.x-i.x,y:this.layout.center.y-i.y},!0)}}async tapDown(t){this.tap=performance.now(),t&&(this.layout.changed=!0,this.tapedHex&&(this.tapedHex.isHighlighted=!1),this.tapedHex=this.hexMap.pixelToHex(this.layout,t),this.tapedHex.isHighlighted=!0)}async tapUp(t){if(this.tap=0,!this.tapedHex)return;this.highlightedHex=this.tapedHex;let e=this.hexMap.hexToPixel(this.layout,this.tapedHex);this.layout.setOrigin({x:this.layout.center.x-e.x,y:this.layout.center.y-e.y},!0),Qt(this.tapedHex.publicStorage,this.tapedHex.publicStoragePS)}async tapMove(t){this.tap&&t&&(this.layout.setOrigin({x:t.x,y:t.y},!0),!(performance.now()-this.tap<100)&&(this.tapedHex=void 0))}debug(){}}addEventListener("load",()=>new ee);
